<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Новогодние салаты</title>
<style>
    body {
        margin: 0;
        background: black;
        overflow: hidden;
        touch-action: none;
        font-family: monospace;
    }
    canvas {
        display: block;
        margin: 0 auto;
        background: linear-gradient(#001122, #002244);
        image-rendering: pixelated;
    }
</style>
</head>
<body>

<canvas id="game" width="360" height="520"></canvas>
<audio id="music" src="music.mp3" loop></audio>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

const music = document.getElementById("music");
music.volume = 0.4;
document.body.addEventListener("click", () => music.play(), { once: true });

let player, salads, snowflakes, lives, score, gameOver;

function resetGame() {
    player = { x: 160, y: 400, w: 28, h: 64, speed: 3 };
    salads = [];
    snowflakes = [];
    lives = 5;
    score = 0;
    gameOver = false;
}
resetGame();

// ───── Управление ─────
let keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// ───── Объекты ─────
function spawnSalad() {
    salads.push({
        x: Math.random() * (canvas.width - 40),
        y: canvas.height + 40,
        speed: 1.5 + Math.random()
    });
}
function spawnSnow() {
    snowflakes.push({
        x: Math.random() * canvas.width,
        y: -5,
        speed: 0.5 + Math.random()
    });
}

// ───── Персонаж ─────
function drawPlayer() {
    const x = player.x;
    const y = player.y;

    // голова
    ctx.fillStyle = "#ffe0bd";
    ctx.fillRect(x + 6, y - 24, 16, 16);

    // волосы
    ctx.fillStyle = "black";
    ctx.fillRect(x + 6, y - 24, 16, 6);

    // глаза
    ctx.fillStyle = "black";
    ctx.fillRect(x + 9, y - 18, 2, 2);
    ctx.fillRect(x + 17, y - 18, 2, 2);

    // нос
    ctx.fillRect(x + 14, y - 16, 2, 4);

    // усы
    ctx.fillRect(x + 10, y - 12, 10, 2);

    // рот
    ctx.fillRect(x + 13, y - 9, 4, 1);

    // шарф
    ctx.fillStyle = "#aa0000";
    ctx.fillRect(x, y - 6, 28, 6);
    ctx.fillStyle = "#dd4444";
    for (let i = 0; i < 28; i += 4)
        ctx.fillRect(x + i, y - 6, 2, 6);

    // пальто
    ctx.fillStyle = "#444";
    ctx.fillRect(x, y, 28, 36);

    // карманы (руки внутри)
    ctx.fillStyle = "#333";
    ctx.fillRect(x + 3, y + 10, 8, 12);
    ctx.fillRect(x + 17, y + 10, 8, 12);

    // брюки
    ctx.fillStyle = "#222";
    ctx.fillRect(x + 4, y + 36, 8, 16);
    ctx.fillRect(x + 16, y + 36, 8, 16);

    // ботинки
    ctx.fillStyle = "black";
    ctx.fillRect(x + 2, y + 52, 10, 6);
    ctx.fillRect(x + 16, y + 52, 10, 6);

    // шнурки
    ctx.fillStyle = "#888";
    ctx.fillRect(x + 5, y + 54, 4, 1);
    ctx.fillRect(x + 19, y + 54, 4, 1);
}

// ───── Салат (полукруглая тарелка) ─────
function drawSalad(s) {
    const cx = s.x + 20;
    const cy = s.y + 20;

    // тень
    ctx.fillStyle = "rgba(0,0,0,0.3)";
    ctx.beginPath();
    ctx.ellipse(cx, cy + 18, 18, 4, 0, 0, Math.PI * 2);
    ctx.fill();

    // тарелка (полукруг)
    ctx.fillStyle = "#ddd";
    ctx.beginPath();
    ctx.arc(cx, cy + 4, 18, Math.PI, 0);
    ctx.fill();
    ctx.strokeStyle = "#aaa";
    ctx.stroke();

    // салат
    ctx.fillStyle = "#cfcfa0";
    ctx.beginPath();
    ctx.arc(cx, cy, 14, Math.PI, 0);
    ctx.fill();

    const ingredients = ["#d9b382", "#7cb342", "#ff8f00", "#fffde7"];
    for (let i = 0; i < 12; i++) {
        ctx.fillStyle = ingredients[Math.floor(Math.random() * ingredients.length)];
        ctx.fillRect(cx - 10 + Math.random() * 20, cy - 10 + Math.random() * 8, 2, 2);
    }
}

// ───── Ёлки жизни ─────
function drawLives() {
    for (let i = 0; i < lives; i++) {
        const x = 280 + i * 14;
        const y = 20;

        // крона
        ctx.fillStyle = "#0a5";
        ctx.beginPath();
        ctx.moveTo(x + 6, y);
        ctx.lineTo(x, y + 14);
        ctx.lineTo(x + 12, y + 14);
        ctx.fill();

        // гирлянда
        ctx.fillStyle = "yellow";
        ctx.fillRect(x + 3, y + 8, 2, 2);
        ctx.fillRect(x + 7, y + 10, 2, 2);

        // звезда
        ctx.fillStyle = "gold";
        ctx.fillRect(x + 5, y - 4, 2, 2);
    }
}

// ───── Логика ─────
function update() {
    if (gameOver) return;

    if (keys["ArrowLeft"]) player.x -= player.speed;
    if (keys["ArrowRight"]) player.x += player.speed;
    if (keys["ArrowUp"]) player.y -= player.speed / 2;
    if (keys["ArrowDown"]) player.y += player.speed / 2;

    player.x = Math.max(0, Math.min(canvas.width - player.w, player.x));
    player.y = Math.max(100, Math.min(canvas.height - player.h, player.y));

    if (Math.random() < 0.02) spawnSalad();
    if (Math.random() < 0.2) spawnSnow();

    salads.forEach((s, i) => {
        s.y -= s.speed;
        if (
            s.x < player.x + player.w &&
            s.x + 40 > player.x &&
            s.y < player.y + player.h &&
            s.y + 30 > player.y
        ) {
            salads.splice(i, 1);
            score++;
        } else if (s.y < -50) {
            salads.splice(i, 1);
            lives--;
            if (lives <= 0) gameOver = true;
        }
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    snowflakes.forEach(f => {
        ctx.fillStyle = "white";
